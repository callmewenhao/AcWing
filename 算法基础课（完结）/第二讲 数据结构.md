#! https://zhuanlan.zhihu.com/p/654408972
# æ•°æ®ç»“æ„

## é“¾è¡¨

> ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿé“¾è¡¨ 

### å•é“¾è¡¨

é‚»æ¥è¡¨ï¼šå­˜å‚¨å›¾å’Œæ ‘ï¼Œåˆåé“¾å¼å‰å‘æ˜Ÿï¼Œ é¢˜ç›®ï¼š[826. å•é“¾è¡¨](https://www.acwing.com/problem/content/828/)

ä½¿ç”¨æ•°ç»„æ¨¡æ‹Ÿå•é“¾è¡¨ é™æ€é“¾è¡¨ğŸ¤—

- `head` è¡¨ç¤ºé“¾è¡¨çš„å½“å‰çš„å¤´èŠ‚ç‚¹ï¼Œ`head=-1` è¡¨ç¤ºé“¾è¡¨ä¸ºç©º
- `e[N]` å­˜å‚¨èŠ‚ç‚¹çš„ value
- `ne[N]` å­˜å‚¨èŠ‚ç‚¹çš„ next
- `idx` è¡¨ç¤ºå½“å‰å¯ä»¥åˆ†é…çš„ä½ç½®ï¼Œä» 0 å¼€å§‹

```C++
// N æ˜¯æœ€å¤§çš„è¾¹æ•°ï¼Œè¾¹æ•°çš„æ•°é‡çº§
int head, e[N], ne[N], idx;
//åˆå§‹åŒ–é“¾è¡¨
void init() {
    head = -1, idx = 0;
}
// è¡¨ç¤ºå‘é“¾è¡¨å¤´æ’å…¥ä¸€ä¸ªæ•° x
void add_to_head(int x) {
    e[idx] = x;
    ne[idx] = head;
    head = idx++;
}
// åœ¨ç¬¬ k ä¸ªæ’å…¥çš„æ•°åé¢æ’å…¥ä¸€ä¸ªæ•° x
// æ³¨æ„ k ä» 1 å¼€å§‹ï¼Œä½†æ˜¯ idx æ˜¯ä» 0 å¼€å§‹çš„ï¼Œæ‰€ä»¥åº”è¯¥ä¼ å…¥ k-1
void add(int k, int x) {
    e[idx] = x;
    ne[idx] = ne[k];
    ne[k] = idx++;
}
// åˆ é™¤ç¬¬ k ä¸ªæ’å…¥çš„æ•°åé¢çš„æ•°
// æ³¨æ„åº”è¯¥ä¼ å…¥ k-1
void remove(int k) {
    ne[k] = ne[ne[k]];
}
// éå†é“¾è¡¨
for (int i = head; i != -1; i = ne[i])
    cout << e[i] << " ";
```

### åŒé“¾è¡¨

æ¯ä¸€ä¸ªèŠ‚ç‚¹æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘å‰é¢å…ƒç´ ï¼Œå¦ä¸€ä¸ªæŒ‡å‘åé¢å…ƒç´ ï¼Œä½œç”¨ï¼šä¼˜åŒ–æŸäº›é—®é¢˜

æ•°ç»„æ¨¡æ‹ŸåŒé“¾è¡¨

- `0` è¡¨ç¤ºå·¦ç«¯ç‚¹ `1` è¡¨ç¤ºå³ç«¯ç‚¹
- `l[N]` å­˜å‚¨å·¦ä¾§èŠ‚ç‚¹
- `r[N]` å­˜å‚¨å³ä¾§èŠ‚ç‚¹
- `idx` è¡¨ç¤ºå½“å‰å¯ä»¥åˆ†é…çš„ä½ç½®

```C++
int m, e[N], l[N], r[N], idx;
// åˆå§‹åŒ–
void init() {
    // 0 è¡¨ç¤ºå·¦ç«¯ç‚¹ï¼Œ1 è¡¨ç¤ºå³ç«¯ç‚¹
    r[0] = 1, l[1] = 0;
    idx = 2;
}
// åœ¨ç¬¬ k ä¸ªç‚¹çš„å³è¾¹æ’å…¥ä¸€ä¸ªç‚¹
void add(int k, int x) {
    e[idx] = x;
    // æ–°æ’å…¥ç‚¹çš„å³è¾¹ = kç‚¹çš„å³è¾¹
    r[idx] = r[k];
    // æ–°æ’å…¥ç‚¹çš„å·¦è¾¹ = k
    l[idx] = k;
    // ä¿®æ”¹ä¹‹å‰çš„è¾¹
    l[r[k]] = idx; // l[r[idx]] = idx
    r[k] = idx++; // r[l[idx]] = idx
}
// åœ¨ç¬¬ k ä¸ªç‚¹çš„å·¦è¾¹æ’å…¥ä¸€ä¸ªç‚¹
// == åœ¨ç¬¬ l[k] ä¸ªç‚¹çš„å³è¾¹æ’å…¥ä¸€ä¸ªç‚¹
// å°±æ˜¯ add(l[k], x)
// åˆ é™¤ç¬¬ k ä¸ªæ’å…¥çš„èŠ‚ç‚¹
void remove(int k) {
    // è®©å·¦è¾¹çš„å³è¾¹ = æˆ‘çš„å³è¾¹
    r[l[k]] = r[k];
    // è®©å³è¾¹çš„å·¦è¾¹ = æˆ‘çš„å·¦è¾¹
    l[r[k]] = l[k];
}
// éå†
for (int i = r[0]; i != 1; i = r[i]) {
    cout << e[i] << " ";
}
```

## æ¨¡æ‹Ÿæ ˆ

æ¨¡æ‹Ÿæ ˆï¼šå…ˆè¿›åå‡º

* `stk[N]` è¡¨ç¤ºæ ˆ
* `tt` è¡¨ç¤ºæ ˆé¡¶æŒ‡é’ˆ
* æ’å…¥å…ƒç´  `stk[++tt] = x`
* å¼¹å‡º `tt--`
* åˆ¤ç©º `tt == 0`

```C++
const int N = 1e5 + 7;  // å¯èƒ½çš„å¤§å°
int stk[N], tt;
```

**æ ˆçš„ç»å…¸åº”ç”¨**

[3302. è¡¨è¾¾å¼æ±‚å€¼](https://www.acwing.com/problem/content/description/3305/)

**æ ˆæ¨¡æ¿** ä½¿ç”¨**åŒæ ˆ**æ¨¡æ‹Ÿè¡¨è¾¾å¼æ±‚å€¼è¿‡ç¨‹

* ä¸€ä¸ªæ ˆ `num` å­˜æ”¾éå†åˆ°çš„æ•°å­—ã€å¦ä¸€ä¸ª `op` å­˜æ”¾éå†åˆ°çš„è¿ç®—ç¬¦ï¼ˆè¿ç®—ä¹‹é—´æœ‰ä¼˜å…ˆçº§ï¼‰
* `eval` å‡½æ•°åˆ™æ˜¯ä½¿ç”¨ **å½“å‰æ ˆé¡¶çš„ä¸¤ä¸ªæ•°å­—** å’Œ **ä¸€ä¸ªè¿ç®—ç¬¦** è®¡ç®—ç»“æœ
* ä¸ºäº†ä¿è¯ç»“æœå‡†ç¡®ï¼Œ`op` ä¸­çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§å¿…é¡»æ˜¯å‡åºçš„ æ¯”å¦‚ï¼š`a+b*c` è€Œä¸æ˜¯ `a*b+c`
* å½“æˆ‘ä»¬é‡åˆ° **ä¼˜å…ˆçº§ä½äº `op` æ ˆé¡¶çš„è¿ç®—ç¬¦æ—¶** æˆ‘ä»¬å°±è¦ä½¿ç”¨ `eval` è®¡ç®—å€¼ï¼Œç›´åˆ° **ä¼˜å…ˆçº§** æ»¡è¶³è¦æ±‚
* æ‹¬å·å•ç‹¬å¤„ç†å³å¯ï¼ŒæŠŠæ‹¬å·å†…çš„è¡¨è¾¾å¼æ±‚å€¼ 
* æœ€åï¼Œä½¿ç”¨ `eval` è®¡ç®— `op` ä¸­å‰©ä½™çš„è¿ç®—

```C++
stack<int> num;
stack<char> op;
// æŠŠå½“å‰çš„ ä¸¤ä¸ªæ•° å’Œ ä¸€ä¸ªæ“ä½œç¬¦ è¿ç®—ä¸€ä¸‹ ç»“æœæ”¾å…¥ num
void eval() {
    int b = num.top(); num.pop();
    int a = num.top(); num.pop();
    char c = op.top(); op.pop();
    int res;
    if (c == '+') res = a + b;
    else if (c == '-') res = a - b;
    else if (c == '*') res = a * b;
    else if (c == '/') res = a / b;
    num.push(res);
}
int main() {
    // è¿ç®—ç¬¦ä¼˜å…ˆçº§
    unordered_map<char, int> pr = {
        {'+', 1}, {'-', 1}, {'*', 2}, {'/', 2},
    };
    string s;
    cin >> s;
    for (int i = 0; i < s.size(); i++) {
        if (isdigit(s[i])) {  // æ•°å­—
            int x = 0, j = i;
            while (j < s.size() && isdigit(s[j])) {
                x = 10 * x + s[j] - '0';
                j++;
            }
            num.push(x);
            i = j - 1;
        } else if (s[i] == '(') {  // '('
            op.push('(');
        } else if (s[i] == ')') {  // ')'
            while (op.top() != '(') {
                eval();
            }
            op.pop();
        } else {  // ä¼˜å…ˆçº§
            while (!op.empty() && op.top() != '(' && pr[s[i]] <= pr[op.top()]) {
                eval();
            }
            op.push(s[i]);
        }
    }
    // å‰©ä½™è¡¨è¾¾å¼
    while (!op.empty()) {
        eval();
    }
    cout << num.top() << endl;
    return 0;
}
```

## æ¨¡æ‹Ÿé˜Ÿåˆ—

æ¨¡æ‹Ÿé˜Ÿåˆ—ï¼šå…ˆè¿›å…ˆå‡º

* `q[N]` é˜Ÿåˆ—
* `hh` å¤´ï¼Œåˆå§‹åŒ–ä¸º `0`ï¼Œå¼¹å‡ºå…ƒç´ ï¼š`hh++`
* `tt` å°¾ï¼Œåˆå§‹åŒ–ä¸º `-1`ï¼Œæ’å…¥å…ƒç´  `x`ï¼š`q[++tt] = x`
* ç©º `hh > tt`
* éç©º `hh <= tt`

```C++
const int N = 1e5+7;
int q[N], tt = -1, hh;
```

## å•è°ƒæ ˆ

æ‰¾åˆ°æ•°ç»„ä¸­æ¯ä¸€ä¸ªæ•° $n_i$ çš„

1. **å·¦ä¾§ç¦» $n_i$ æœ€è¿‘ä¸”æ¯” $n_i$ å¤§çš„æ•°**ï¼šä»å·¦å¼€å§‹éå†ï¼Œç»´æŠ¤å•è°ƒæ ˆã€‚å¦‚æœæ ˆç©ºï¼Œåˆ™è¡¨æ˜å·¦ä¾§æ²¡æœ‰æ¯” $n_i$ å¤§çš„æ•°ï¼›å¦‚æœæ ˆé¡¶å¤§äº$n_i$ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯æ ˆé¡¶ï¼›å¦‚æœæ ˆé¡¶å°äºç­‰äº$n_i$ï¼Œé‚£ä¹ˆå¼¹å‡ºæ ˆé¡¶ç›´åˆ°å‰é¢çš„æƒ…å†µå‡ºç°ï¼Œæœ€åæ”¾å…¥å½“å‰çš„æ•°ã€‚

2. **å³ä¾§ç¦» $n_i$ æœ€è¿‘ä¸”æ¯” $n_i$ å¤§çš„æ•°**ï¼šä»å³å¼€å§‹éå†ï¼Œå…¶ä»–åŒ 1ã€‚

3. **å·¦ä¾§ç¦» $n_i$ æœ€è¿‘ä¸”æ¯” $n_i$ å°çš„æ•°**ï¼šä»å·¦å¼€å§‹éå†ï¼Œç»´æŠ¤å•è°ƒæ ˆã€‚å¦‚æœæ ˆç©ºï¼Œåˆ™è¡¨æ˜å·¦ä¾§æ²¡æœ‰æ¯” $n_i$ å°çš„æ•°ï¼›å¦‚æœæ ˆé¡¶å°äº$n_i$ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±æ˜¯æ ˆé¡¶ï¼›å¦‚æœæ ˆé¡¶å¤§äºç­‰äº$n_i$ï¼Œé‚£ä¹ˆå¼¹å‡ºæ ˆé¡¶ç›´åˆ°å‰é¢çš„æƒ…å†µå‡ºç°ï¼Œæœ€åæ”¾å…¥å½“å‰çš„æ•°ã€‚

4. **å³ä¾§ç¦» $n_i$ æœ€è¿‘ä¸”æ¯” $n_i$ å°çš„æ•°**ï¼šä»å³å¼€å§‹éå†ï¼Œå…¶ä»–åŒ 3ã€‚

å½“éœ€è¦ä¸Šè¿°æ€§è´¨æ—¶ï¼Œå°±æ˜¯å•è°ƒæ ˆé¢˜ç›®

ç”¨æ•°ç»„æ¨¡æ‹Ÿçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨æ ˆä¸Šè¿›è¡ŒäºŒåˆ†ï¼Œå› ä¸ºæ ˆä¸Šæ˜¯æœ‰åºçš„

```C++
// å·¦ä¾§å°äº
stack<int> st;
for (int i = 0; i < n; i++) {
    int x;
    cin >> x;
    
    while (!st.empty() && st.top() >= x) {
        st.pop();
    }
    if (st.empty()) cout << -1 << " ";
    else cout << st.top() << " ";
    st.push(x);
}
```

## å•è°ƒé˜Ÿåˆ—

ç»´æŠ¤åŒºé—´ï¼ˆçª—å£ï¼‰æœ€å¤§ã€æœ€å°å€¼ã€‚ç»å…¸é¢˜ç›®å°±æ˜¯æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§æœ€å°å€¼

æ³¨æ„é˜Ÿåˆ—é‡Œé¢å­˜çš„ä¸æ˜¯å€¼è€Œæ˜¯**ä¸‹æ ‡**ï¼Œè¿™ä¸€ç‚¹ç»å¸¸å¿˜è®°ğŸ˜£

```C++
// æ•°ç»„å†™æ³•
// min
hh = 0, tt = -1;
for (int i = 0; i < n; i++) {
    // é˜Ÿå°¾
    while (hh <= tt && a[q[tt]] >= a[i]) {
        tt--;
    }
    // æ’å…¥æ–°ä¸‹æ ‡
    q[++tt] = i;
    // é˜Ÿå¤´ k - 1ï¼Œè¿™é‡Œç”¨ if å°±å¯ä»¥ï¼Œæ ¹æ®é¢˜æ„æœ€å¤šåªæœ‰1ä¸ªå¯¹å¤´ä¸æ»¡è¶³è¦æ±‚
    if (q[hh] <= i - k) hh++;
    // å½“ä¸‹æ ‡å¤§äºç­‰äº k - 1 æ—¶è¾“å‡ºç­”æ¡ˆ
    if (i >= k - 1) cout << a[q[hh]] << " ";
}
// ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€
// stl åŒç«¯é˜Ÿåˆ— deque å†™æ³•
//min
for (int i = 0; i < n; i++) {
    while (!q.empty() && a[q.back()] >= a[i]) {
        q.pop_back();
    }
    q.push_back(i);
    if (q.front() <= i-k) q.pop_front();
    
    if (i >= k-1)cout << a[q.front()] << " ";
}
```

åŒæ ·çš„ï¼Œç”¨æ•°ç»„æ¨¡æ‹Ÿçš„å¥½å¤„æ˜¯**é€Ÿåº¦å¿«**ï¼Œå¹¶å¯ä»¥åœ¨**é˜Ÿåˆ—å†…äºŒåˆ†**ï¼Œå› ä¸ºé˜Ÿåˆ—å†…éƒ¨ä¹Ÿæ˜¯æœ‰åºçš„

å¯¹äºæ±‚åŒºé—´æœ€å¤§æœ€å°å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `stl` ä¸­çš„ `multiset` æ¨¡æ¿ç±»ï¼ˆæœ‰åºè¡¨ï¼‰ï¼Œåº•å±‚æ˜¯**å¹³è¡¡æœç´¢æ ‘**ï¼Œæ’å…¥ã€åˆ é™¤ã€æœç´¢éƒ½æ˜¯ `logn` æ—¶é—´ï¼Œè€Œä¸”è¿˜æä¾›äº†åœ¨ `set` ä¸­äºŒåˆ†çš„ api

```C++
// multiset é‡Œé¢å­˜å€¼å°±å¥½äº†
multiset<int> st;
// å…ˆæ”¾å…¥ k-1 ä¸ªæ•°
for (int i = 1; i < k; i++) {
    st.insert(a[i]);
}
for (int i = k; i <= n; i++) {
    // æ”¾å…¥å³è¾¹çš„æ•°
    st.insert(a[i]);
    // æ‹¿åˆ°æœ€å¤§æœ€å°å€¼
    mx[cnt] = *st.rbegin();
    mn[cnt++] = *st.begin();
    // æ‹¿å‡ºå·¦è¾¹çš„æ•° erase éœ€è¦ä½¿ç”¨ find æ‰¾åˆ°è¿­ä»£å™¨è€Œä¸æ˜¯è¦åˆ é™¤çš„å€¼
    st.erase(st.find(a[i-k+1]));
}
```

## KMP å­—ç¬¦ä¸²åŒ¹é…

[OI WiKi å…³äº KMP çš„ä»‹ç»](https://oi-wiki.org/string/kmp/)ï¼šé€šè¿‡**å‰ç¼€å‡½æ•°**æ±‚ `next` æ•°ç»„ï¼Œä»¥åŠ KMP åŒ¹é…ã€å­—ç¬¦ä¸²çš„å¾ªç¯èŠ‚ç­‰

åŸå­—ç¬¦ä¸² s[N]ï¼Œç›®æ ‡ä¸² p[M]ï¼Œæ±‚ p åœ¨ s ä¸­åŒ¹é…çš„ä½ç½®

**æš´åŠ›æšä¸¾** åŒ¹é…å­—ç¬¦ä¸²ï¼šä¸¤ä¸ª `for` å¾ªç¯

- æšä¸¾åŒ¹é…çš„èµ·å§‹ä½ç½® i

- ä»èµ·å§‹ä½ç½®å¼€å§‹åŒ¹é… `p[1, m]`ä¸² j

- å¦‚æœä¸Šä¸€æ­¥åŒ¹é…å‡ºç°é—®é¢˜ï¼Œå°±ä» i+1 ç»§ç»­æšä¸¾

**KMP** åŒ¹é…å­—ç¬¦ä¸²ï¼šæ€è·¯ä¸æš´åŠ›ä¸åŒ

* åŒæŒ‡é’ˆ i æŒ‡å‘åŸä¸²ï¼Œj æŒ‡å‘ç›®æ ‡ä¸²ï¼Œå‡è®¾å·²ç»æœ‰ `s[i-j, i-1] = p[1, j]`

* å¦‚æœ `s[i] == p[j+1]`ï¼Œåˆ™ `i++, j++`

* å¦‚æœ `s[i] != p[j+1]`ï¼Œé€’å½’åœ°ä½¿ç”¨ `next[j]` å¯¹åº”çš„å‰ç¼€ï¼ˆæˆ–è€…åç¼€ï¼‰ æ¥åŒ¹é… `s[i-j, i-1]`
    - å¦‚æœï¼Œåœ¨æŸæ¬¡åŒ¹é…æ—¶ `s[i] == p[j+1]` åˆ™é€’å½’ç»“æŸï¼Œç»§ç»­å‘å‰ç§»åŠ¨åŒæŒ‡é’ˆ

    - å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœé€’å½’è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å‘ç”Ÿ `s[i] == p[j+1]`ï¼Œé‚£æ„å‘³ç€æœ€ç»ˆè¦ä¸‹æ ‡ä» 1 åŒ¹é…ï¼Œä¹Ÿå°±å›å½’åˆ°æš´åŠ›äº†ã€‚

**next æ•°ç»„**ï¼š`next[i] = j` è¡¨ç¤º p ä¸­ä»¥ i ä¸ºç»ˆç‚¹çš„åç¼€ æ‰€èƒ½åŒ¹é…çš„ æœ€é•¿çš„ ä¸ä¹‹ç›¸ç­‰çš„å‰ç¼€é•¿åº¦æ˜¯ jï¼Œä¹Ÿå°±æ˜¯ p[1, j] = p[i-j+1, i] ä¸” j æœ€å¤§ã€‚æ±‚ next æ•°ç»„çš„è¿‡ç¨‹å’ŒåŒ¹é…è¿‡ç¨‹ç±»ä¼¼

```C++
// y æ€»ä¸‹æ ‡ä» 1 å¼€å§‹çš„æ¨¡æ¿

// æ±‚ next æ•°ç»„
// æ³¨æ„å‰ç¼€å’Œåç¼€ä¸èƒ½å®Œå…¨é‡åˆ æ‰€ä»¥ next[1] = 0 æˆ‘ä»¬ä» 2 å¼€å§‹è®¡ç®— next[i]ï¼Œå¦ä¸€ç§è§£é‡Šï¼šå½“ç¬¬ä¸€ä¸ªå­—ç¬¦éƒ½ä¸ç›¸ç­‰ï¼ŒæˆåŠŸåŒ¹é…çš„é•¿åº¦æ˜¯ 0 
for (int i = 2, j = 0; i <= n; i++) {
    while (j && p[i] != p[j + 1])
        j = ne[j];
    if (p[i] == p[j + 1]) j++;
    // è®°å½•ä¸€ä¸‹è¿™ä¸ªåŒ¹é…æˆåŠŸçš„ next æ•°ç»„å€¼
    ne[i] = j;
}

// KMP åŒ¹é…è¿‡ç¨‹
// i è¡¨ç¤ºç›®æ ‡ä¸²æ­£è¦åŒ¹é…çš„å­—ç¬¦ä¸‹æ ‡
// j è¡¨ç¤ºæˆåŠŸåŒ¹é…çš„æ¨¡å¼ä¸²çš„é•¿åº¦ 
// p[j + 1]æ˜¯æ¨¡å¼ä¸²è¦å’Œç›®æ ‡ä¸²åŒ¹é…çš„å­—ç¬¦
for (int i = 1, j = 0; i <= m; i++) {
    // å½“å·²ç»æœ‰åŒ¹é…çš„é•¿åº¦ å¹¶ä¸” è¦åŒ¹é…çš„å­—ç¬¦ä¸ç›¸ç­‰ ä¿®æ”¹æˆåŠŸåŒ¹é…çš„é•¿åº¦
    while (j && s[i] != p[j + 1])
        j = ne[j];
    if (s[i] == p[j + 1]) j++;  // æˆåŠŸåŒ¹é…çš„ä¸ªæ•°++
    if (j == n) { // åŒ¹é…æˆåŠŸ è¾“å‡ºä¸‹æ ‡
        cout << i - n << " ";
        j = ne[j];  // åŒ¹é…æˆåŠŸå å¾€åé€€æ­¥ ä½†æ˜¯ä¸å¿…ä» 1 å¼€å§‹ ä»ç„¶ä»èƒ½åŒ¹é…çš„æœ€å¤§é•¿åº¦å¼€å§‹
    }
}

// ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€
// ä¸‹æ ‡ä» 0 å¼€å§‹çš„æ¨¡æ¿
// æ±‚ next æ•°ç»„
// ne[0] = 0; int j = ne[i - 1];
// i è¡¨ç¤ºç›®æ ‡ä¸²æ­£è¦åŒ¹é…çš„å­—ç¬¦ä¸‹æ ‡
// j è¡¨ç¤ºæˆåŠŸåŒ¹é…çš„æ¨¡å¼ä¸²çš„é•¿åº¦
for (int i = 1, j = 0; i < n; i++) {
    while (j && p[i] != p[j]) j = ne[j-1];
    if (p[i] == p[j]) j++;
    ne[i] = j;
}

// KMP åŒ¹é…è¿‡ç¨‹
for (int i = 0, j = 0; i < m; i++) {
    while (j && s[i] != p[j]) j = ne[j-1];
    if (s[i] == p[j]) j++;
    if (j == n) {
        cout << i - n + 1 << " ";
        j = ne[j-1];
    }
}
```

åŠ›æ‰£ 28 é¢˜ï¼š[28. æ‰¾å‡ºå­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„ä¸‹æ ‡](https://leetcode.cn/problems/find-the-index-of-the-first-occurrence-in-a-string/)

```C++
// ä¸‹æ ‡ä» 0 å¼€å§‹
const int N = 1e4+7;
int ne[N];

int strStr(string s, string p) {
    memset(ne, 0, sizeof ne);

    int n = s.size(), m = p.size();
    // æ³¨æ„ i ä» 1 å¼€å§‹
    for (int i = 1, j = 0; i < m; i++) {
        while (j && p[i] != p[j]) j = ne[j-1];
        if (p[i] == p[j]) j++;
        ne[i] = j;
    }

    for (int i = 0, j = 0; i < n; i++) {
        while (j && s[i] != p[j]) j = ne[j-1];
        if (s[i] == p[j]) j++;
        if (j == m) {
            return i - m + 1;
        } 
    }
    return -1;
}
```

## Trie æ ‘

> Trie æ ‘ï¼Œåˆå«å‰ç¼€æ ‘ã€‚å¿«é€Ÿå­˜å‚¨å­—ç¬¦ä¸²é›†åˆ

å› ä¸ºè¦ç»´æŠ¤ä¸€æ£µæ ‘ï¼Œåœ¨å®ç°çš„æ—¶å€™å®é™…ä¸Šæ˜¯ä½¿ç”¨äº†å•é“¾è¡¨ï¼ˆé“¾å¼å‰å‘æ˜Ÿï¼‰

* `son[N][26]` å­˜æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å„¿å­ã€‚`son[N][i] = 1` è¡¨ç¤ºç¬¬ i ä¸ªå„¿å­å­˜åœ¨ï¼›å¦åˆ™è¡¨ç¤ºä¸å­˜åœ¨ç¬¬ i ä¸ªå„¿å­

* `cnt[N]` ä»¥å½“å‰è¿™ä¸ªç‚¹ç»“å°¾çš„å•è¯æœ‰å¤šå°‘ä¸ª

* `idx` å½“å‰å·²ç»åˆ†é…çš„ä¸‹æ ‡ã€‚æ³¨æ„ `idx = 0` æ˜¯æ ¹èŠ‚ç‚¹ï¼Œè€Œä¸”æ˜¯ç©ºèŠ‚ç‚¹ï¼ˆä¸å«å­—ç¬¦ï¼‰ï¼Œå­©å­èŠ‚ç‚¹è¦ä»ä¸‹æ ‡ 1 å¼€å§‹å»ºç«‹

* æ³¨æ„ `N` çš„å«ä¹‰ï¼šå› ä¸ºæœ¬è´¨æ˜¯å•é“¾è¡¨ï¼Œæ•… N åº”è¯¥æ˜¯æ‰€æœ‰è¾¹ï¼ˆç‚¹ï¼‰çš„ä¸ªæ•°ã€‚ä»è¿™é‡Œä¹Ÿèƒ½çœ‹å‡º Trie æ ‘çš„ç¼ºç‚¹ï¼Œ`N` æ— æ³•å¼€å¾ˆå¤§ï¼Œä¹Ÿæ„å‘³ç€å­©å­æ•°ç›®ä¸èƒ½å¤ªå¤§ï¼

[835. Trieå­—ç¬¦ä¸²ç»Ÿè®¡](https://www.acwing.com/problem/content/description/837/) è¿™ä¸ªé¢˜ç›®æ˜ç¡®è¯´äº†ï¼Œæ‰€æœ‰å­—ç¬¦ä¸²çš„é•¿åº¦ä¹‹å’Œä¸è¶… `1e5`ï¼Œä¹Ÿå°±æ„å‘³ç€ `N` åœ¨ `1e5` èŒƒå›´å†…ã€‚

```C++
const int N = 1e5+7; // æ€»ç‚¹ï¼ˆè¾¹ï¼‰æ•°
int n;  // op æ•°
int son[N][26], cnt[N], idx;
// æ’å…¥ s
void insert(string& s) {
    int p = 0; // å¤´èŠ‚ç‚¹
    for (int i = 0; i < s.size(); i++) {
        int u = s[i] - 'a';  
        if (!son[p][u]) son[p][u] = ++idx; // å­©å­çš„ä½ç½®
        p = son[p][u]; // ä»å­©å­çš„ idx ç»§ç»­æ‰¾
    }
    cnt[p]++;
}
// æŸ¥è¯¢ s è¿”å› s çš„ä¸ªæ•°
int query(string& s) {
    int p = 0;
    for (int i = 0; i < s.size(); i++) {
        int u = s[i] - 'a';
        if (!son[p][u]) return 0;
        p = son[p][u];
    }
    return cnt[p];
}
```

åŠ›æ‰£ [208. å®ç° Trie (å‰ç¼€æ ‘)](https://leetcode.cn/problems/implement-trie-prefix-tree/) å¾—è‡ªå·±ä¼°è®¡ä¸€ä¸‹ `N` çš„èŒƒå›´ `1e4` ä¸è¡Œ `1e5` å¯ä»¥

```C++
const int N = 1e5+7;

class Trie {
public:
    int son[N][26];
    int cnt[N];
    int idx;

    Trie() {
        memset(son, 0, sizeof son);
        memset(cnt, 0, sizeof cnt);
        idx = 0;
    }
    
    void insert(string s) {
        int p = 0;
        for (int i = 0;  i < s.size(); i++) {
            int u = s[i] - 'a';
            if (!son[p][u]) son[p][u] = ++idx;
            p = son[p][u];
        }
        cnt[p]++;
    }
    
    bool search(string s) {
        int p = 0;
        for (int i = 0;  i < s.size(); i++) {
            int u = s[i] - 'a';
            if (!son[p][u]) return false;
            p = son[p][u];
        }
        return cnt[p] != 0;
    }
    
    bool startsWith(string s) {
        int p = 0;
        for (int i = 0;  i < s.size(); i++) {
            int u = s[i] - 'a';
            if (!son[p][u]) return false;
            p = son[p][u];
        }
        return true;
    }
};
```

[143. æœ€å¤§å¼‚æˆ–å¯¹](https://www.acwing.com/problem/content/145/) é™„ä¸€é“åŠ›æ‰£ï¼š[LCR 067. æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„æœ€å¤§å¼‚æˆ–å€¼](https://leetcode.cn/problems/ms70jA/)

```C++
const int N = 1e5+7, M = 31 * N;  // ä¸€å…± N ä¸ªæ•° æ¯ä¸ªæ•° 31 ä½
int n, a;
int son[M][2], idx;
void insert(int x) {
    int p = 0;
    for (int i = 30; i >= 0; i--) {
        int u = x >> i & 1;
        if (!son[p][u]) son[p][u] = ++idx;
        p = son[p][u];
    }
}
int query(int x) {
    int res = 0, p = 0;
    for (int i = 30; i >= 0; i--) {
        int u = x >> i & 1;
        if (son[p][!u]) {
            res |= 1 << i;
            p = son[p][!u];
        } else 
            p = son[p][u];
    }
    return res;
}
int main() {
    cin >> n;
    int res = 0;
    for (int i = 0; i < n; i++) {
        cin >> a;
        insert(a);
        int t = query(a);
        res = max(res, t);
    }
    cout << res;
    return 0;
}
```

ä¸€é“ä¸é”™çš„é¢˜ç›® [1803. ç»Ÿè®¡å¼‚æˆ–å€¼åœ¨èŒƒå›´å†…çš„æ•°å¯¹æœ‰å¤šå°‘](https://leetcode.cn/problems/count-pairs-with-xor-in-a-range)

## å¹¶æŸ¥é›†

> æˆ‘æœ€å–œæ¬¢çš„æ•°æ®ç»“æ„ä¹‹ä¸€ğŸ˜‹

å¹¶æŸ¥é›†å¯ä»¥**å¿«é€Ÿå®Œæˆ**ï¼ˆæ—¶é—´è¿‘ä¹ O1ï¼‰ï¼š

- åˆå¹¶ä¸¤ä¸ªé›†åˆ

- è¯¢é—®ä¸¤ä¸ªå…ƒç´ æ˜¯å¦åœ¨åŒä¸€é›†åˆå†…

- è¯¢é—®ï¼ˆç»´æŠ¤ï¼‰é›†åˆå†…éƒ¨çš„å…ƒç´ æ•°é‡

- æŸ¥è¯¢è¿é€šåˆ†é‡çš„ä¸ªæ•°

**åŸºæœ¬åŸç†**

* æ¯ä¸ªé›†åˆç”¨ç”¨ä¸€æ£µæ ‘æ¥è¡¨ç¤º

* æ ‘æ ¹çš„ç¼–å·å°±æ˜¯æ•´ä¸ªé›†åˆçš„ç¼–å·

* æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å®ƒçš„çˆ¶èŠ‚ç‚¹ `p[x]` è¡¨ç¤º `x` çš„çˆ¶èŠ‚ç‚¹

**åˆ¤æ–­ x æ˜¯å¦æ˜¯æ ‘æ ¹**

* `p[x] == x `

**æ±‚ x çš„é›†åˆç¼–å·**

```C++
// åˆå§‹åŒ– å¹¶æŸ¥é›† ä¸»è¦æ˜¯åˆå§‹åŒ– p[n] 
for (int i = 1; i <= n; i++) {
    p[i] = i;
    size[i] = 1;  // ç»´æŠ¤é›†åˆå†…çš„å…ƒç´ æ•°é‡ åªæœ‰æ ¹èŠ‚ç‚¹çš„æ•°é‡æ‰æœ‰æ„ä¹‰
}
// æˆ–è€…
iota(p, p+n+1, 0);
fill(size, size+n+1, 1);
 
// è¿”å› x çš„çˆ¶èŠ‚ç‚¹ï¼ˆé›†åˆç¼–å·ï¼‰ä½¿ç”¨è·¯å¾„å‹ç¼©ä¼˜åŒ–
int find(int x) {
    if (p[x] != x) p[x] = find(p[x]); // è·¯å¾„å‹ç¼©
    return p[x];
}
```

**åˆå¹¶é›†åˆ**

åˆå¹¶ç‚¹ `a` å’Œ `b` æ‰€åœ¨çš„é›†åˆï¼Œ`p[a]` å’Œ `p[b]` ä¹‹é—´åŠ ä¸€æ¡è¾¹

```C++
// å¾—ä¿è¯ a å’Œ b ä¸åœ¨åŒä¸€é›†åˆå†…éƒ¨
size[find(a)] += size[find(b)]; // å…ˆåˆå¹¶èŠ‚ç‚¹æ•°é‡
p[find(b)] = find(a);  // åˆå¹¶æ“ä½œ

// b æ‰€åœ¨é›†åˆåˆå¹¶åˆ° a æ‰€åœ¨é›†åˆ
int pa = find(a), pb = find(b);
si[pa] += si[pb];
p[pb] = pa;
```

**è¿é€šåˆ†é‡çš„ä¸ªæ•°**

```C++
int cnt = 0;
for (int i = 1; i <= n; i++) {
    if (p[i] == i) cnt++;
}
```

**ä½¿ç”¨å¹¶æŸ¥é›†ç»´æŠ¤é¢å¤–ä¿¡æ¯**

[240. é£Ÿç‰©é“¾](https://www.acwing.com/problem/content/242/)

ä½¿ç”¨å¹¶æŸ¥é›†ç»´æŠ¤ **æ¯ä¸ªç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»**

* æŠŠéå†åˆ°çš„åˆæ³•çš„ç‚¹éƒ½æ”¾è¿›ä¸€æ£µæ ‘ä¸­
* åŒæ—¶ç”¨**ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»**ä»£è¡¨**ç§ç±»**
* è·ç¦» % 3 == 0 è¡¨ç¤ºå’Œæ ¹èŠ‚ç‚¹ä¸€ç±»
* è·ç¦» % 3 == 1 è¡¨ç¤ºåƒæ ¹èŠ‚ç‚¹çš„ä¸€ç±»
* è·ç¦» % 3 == 2 è¡¨ç¤ºåƒ è·ç¦» % 3 == 1 çš„ä¸€ç±» åŒæ—¶è¢« æ ¹èŠ‚ç‚¹ä¸€ç±»åƒ

```C++
const int N = 1e5+7;
int p[N], d[N];
// æ‰¾åˆ°æ ¹èŠ‚ç‚¹ åŒæ—¶ç»´æŠ¤èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦»
int find(int x) {
    if (p[x] != x) {
        int t = find(p[x]);
        d[x] += d[p[x]];
        p[x] = t;
    }
    return p[x];
}
int main() {
    int n, m;
    cin >> n >> m;
    // åˆå§‹åŒ–
    for (int i = 1; i <= n; i++) {
        p[i] = i;
    }
    // åˆ¤æ–­çœŸå‡
    int res = 0;
    while (m--) {
        int t, x, y;
        cin >> t >> x >> y;
        if (x > n || y > n) res++;
        else {
            int px = find(x), py = find(y);
            if (t == 1) {
                // åˆ¤æ–­æ˜¯ä¸æ˜¯åŒä¸€ç±»
                if (px == py && (d[x] - d[y]) % 3) res++;
                else if (px != py) {  // ä½œä¸ºçœŸè¯åˆå¹¶æˆä¸€æ£µæ ‘
                    p[px] = py;  // py ä½œä¸ºæ–°æ ¹
                    d[px] = d[y] - d[x];  // æ›´æ–° d[px]
                }
            } else {
                // åˆ¤æ–­åƒä¸è¢«åƒå…³ç³»
                if (px == py && (d[x] - d[y] - 1) % 3) res++;
                else if (px != py) { // ä½œä¸ºçœŸè¯åˆå¹¶æˆä¸€æ£µæ ‘
                    p[px] = py;  // py ä½œä¸ºæ–°æ ¹
                    d[px] = d[y] - d[x] + 1;  // æ›´æ–° d[px]
                }
            }
        }
    }
    cout << res <<endl;
    return 0;
}
```

## å †

å †æ˜¯ä¸€æ£µ**å®Œå…¨äºŒå‰æ ‘**ï¼Œä½¿ç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„å­˜å‚¨ï¼ˆæ³¨æ„ä¸‹æ ‡ä» 1 å¼€å§‹ï¼Œè¿™æ ·æ–¹ä¾¿ï¼‰

**å°æ ¹å †**ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼å°äºç­‰äºå„¿å­çš„å€¼ã€‚èŠ‚ç‚¹ `i` çš„å·¦å„¿å­ä¸‹æ ‡æ˜¯ `i*2`ï¼Œå³å„¿å­ä¸‹æ ‡æ˜¯ `i*2+1`

**æ ¸å¿ƒæ“ä½œ**

* `down()` å…ƒç´ ä¸‹æ²‰æ“ä½œï¼Œä¸‹æ²‰åˆ°åˆé€‚çš„ä½ç½®
* `up()` å…ƒç´ ä¸Šæµ®æ“ä½œï¼Œä¸Šæµ®åˆ°åˆé€‚çš„ä½ç½®

**æ’å…¥æ–°å…ƒç´ **ï¼šåœ¨å †çš„æœ€åæ’å…¥ä¸€ä¸ªæ–°å…ƒç´ ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°ä¸Šæµ®åˆ°åˆé€‚çš„ä½ç½®

**æ±‚æœ€å°å€¼**ï¼šç”±äºç»´æŠ¤çš„æ˜¯æœ€å°å †ï¼Œåˆ™æœ€å°å€¼å°±æ˜¯å †çš„ç¬¬ä¸€ä¸ªå…ƒç´ 

**åˆ é™¤æœ€å°å€¼**ï¼šå¾ˆæœ‰æŠ€å·§æ€§ï¼ŒæŠŠå †ä¸­æœ€åä¸€ä¸ªå…ƒç´ è¦†ç›–å †é¡¶ï¼Œç„¶åå †å¤§å°å‡ä¸€ï¼Œå†ä¸‹æ²‰æ“ä½œ `down(1)`

**åˆ é™¤ä»»æ„å…ƒç´ **ï¼šæ¯”å¦‚ï¼šåˆ é™¤ç¬¬ `k` ä¸ªå…ƒç´ ã€‚ä¸åˆ é™¤æœ€å°å€¼ç±»ä¼¼ï¼ŒæŠŠç¬¬ `k` ä¸ªå…ƒç´ ç”¨å †ä¸­æœ€åä¸€ä¸ªå…ƒç´ è¦†ç›–ï¼Œç„¶åå †å¤§å°å‡ä¸€ï¼Œç„¶å `down(k)` `up(k)` å…¶å® `down(k)` `up(k)` ä¸ä¼šå…¨éƒ¨æ‰§è¡Œï¼Œåªä¼šèµ°å…¶ä¸­ä¸€ä¸ª

**ä¿®æ”¹ä»»æ„å…ƒç´ **ï¼šæ¯”å¦‚ï¼šä¿®æ”¹ç¬¬ `k` ä¸ªå…ƒç´ ã€‚æŠŠç¬¬ `k` ä¸ªå…ƒç´ ç”¨æ–°å€¼è¦†ç›–ï¼Œç„¶å `down(k)` `up(k)` ä¸ä¼šå…¨éƒ¨æ‰§è¡Œï¼Œåªä¼šèµ°å…¶ä¸­ä¸€ä¸ª

**O(n) å»ºå †**ï¼šä» `n/2` å¤„å¼€å§‹ `down()`ï¼Œ`n/2` å¾ˆå¦™ï¼æ€»çš„æ—¶é—´æ˜¯ O(n) çš„ğŸ‘

[838. å †æ’åº](https://www.acwing.com/problem/content/840/)

```C++
int n, m;
int h[N], si;
// ä¸‹æ²‰
void down(int x) {
    int t = x;
    if (2 * x <= si && h[2 * x] < h[t]) t = 2 * x;
    if (2 * x + 1 <= si && h[2 * x + 1] < h[t]) t = 2 * x + 1;
    if (x != t) {
        swap(h[x], h[t]);
        down(t);
    }
}

// ä¸Šæµ®
void up(int u) {
    while (u / 2 && h[u/2] > h[u]) {
        swap(h[u], h[u/2]);
        u /= 2;
    }
}

// main()
cin >> n >> m;
for (int i = 1; i <= n; i++) cin >> h[i];
// æ•°ç»„å †åŒ–
si = n;
for (int i = n / 2; i; i--) down(i);
// å‰ m ä¸ªå…ƒç´ 
while (m--) {
    cout << h[1] << " ";
    h[1] = h[si--]; // è¦†ç›– h[1] & down(1)
    down(1);
}
```

[839. æ¨¡æ‹Ÿå †](https://www.acwing.com/problem/content/841/)

```C++
// ph[k] ç¬¬ k ä¸ªæ’å…¥çš„æ•°å¯¹åº”å †ä¸­çš„ä¸‹æ ‡
// hp[i] å †ä¸­ä¸‹æ ‡æ˜¯ i çš„å…ƒç´ å¯¹åº”æ’å…¥çš„é¡ºåº
int h[N], ph[N], hp[N], cnt;
// äº¤æ¢
void heap_swap(int a, int b) {
    swap(ph[hp[a]], ph[hp[b]]);
    swap(hp[a], hp[b]);
    swap(h[a], h[b]);
}    
// ä¸‹æ²‰
void down(int x) {
    int t = x;
    if (2 * x <= cnt && h[2 * x] < h[t]) t = 2 * x;
    if (2 * x + 1 <= cnt && h[2 * x + 1] < h[t]) t = 2 * x + 1;
    if (x != t) {
        heap_swap(x, t);
        down(t);
    }
}
// ä¸Šæµ®
void up(int x) {
    while (x / 2 && h[x] < h[x / 2]) {
        heap_swap(x, x / 2);
        x /= 2;
    }
}
int main() {
    int n, m = 0;
    cin >> n;
    while (n--) {
        string op;
        cin >> op;

        int k, x;
        if (op == "I") {
            cin >> x;
            cnt++;
            m++;
            ph[m] = cnt, hp[cnt] = m;
            h[cnt] = x;
            // æ’å…¥ä¹‹åè¦ä¸Šæµ®
            up(cnt);
        } else if (op == "PM") {
            cout << h[1] << endl;
        } else if (op == "DM") {
            heap_swap(1, cnt);
            cnt--;
            // åˆ é™¤æœ€å°å€¼ä¹‹åè¦ä¸‹æ²‰
            down(1);
        } else if (op == "D") {
            cin >> k;
            k = ph[k];
            heap_swap(k, cnt);
            cnt--;
            // åˆ é™¤ä¸­é—´çš„è¦ä¸Šæµ®æˆ–è€…ä¸‹æ²‰
            up(k);
            down(k);
        } else if (op == "C") {
            cin >> k >> x;
            k = ph[k];
            h[k] = x;
            // ä¿®æ”¹ä¸­é—´çš„è¦ä¸Šæµ®æˆ–è€…ä¸‹æ²‰
            up(k);
            down(k);
        }
    }
    return 0;
}
```
 
## å“ˆå¸Œè¡¨

### å­˜å‚¨ç»“æ„ 

**æ‹‰é“¾æ³•**ï¼šå…ˆæŠŠæ•°å­—ï¼ˆ-1e9~1e9ï¼‰æ˜ å°„åˆ° 0~1e5+3 ä¸ªæ§½ä¸­ï¼ˆæœ«å°¾çš„æ•°å­—å»ºè®®æ˜¯è´¨æ•°ï¼‰ï¼Œç„¶ååœ¨ 0~1e5+3 çš„æ¯ä¸ªæ§½å»ºä¸€ä¸ªé“¾è¡¨å­˜æ•°å­—ï¼ˆæ•°ç»„æ¨¡æ‹Ÿå³å¯ï¼‰

```C++
// æ‹‰é“¾æ³•
const int N = 1e5+3; // æ˜ å°„æ•°ç»„ï¼ˆæ§½ï¼‰çš„å¤§å° ä¸€èˆ¬å–è´¨æ•°
int h[N], e[N], ne[N], idx;
// æ’å…¥
void insert(int x) {
    // C++ å–æ¨¡çš„ç¬¦å·ä¸ x ç›¸åŒ
    int t = (x % N + N) % N;  // t å…¶å®å°±æ˜¯ x åœ¨ set ä¸­çš„ key
    e[idx] = x;
    ne[idx] = h[t];
    h[t] = idx++;
}
// æŸ¥è¯¢
bool find(int  x) {
    int t = (x % N + N) % N;
    // éå†é“¾è¡¨
    for (int i = h[t]; ~i; i = ne[i]) {
        if (e[i] == x) return true;
    }
    return false;
}
int main() {
    // åˆå§‹åŒ– æ§½
    memset(h, -1, sizeof(h));  // -1 è¡¨ç¤ºæ§½ä¸Šæ²¡æœ‰å…ƒç´ ï¼ˆä¸ºç©ºï¼‰
    int n;
    cin >> n;
    char op;
    int x;
    while (n--) {
        cin >> op >> x;
        if (op == 'I') {
            insert(x);
        } else if (op == 'Q') {
            if (find(x)) cout << "Yes" << endl;
            else cout << "No" << endl;
        }
    }

    return 0;
}
```

**å¼€æ”¾å¯»å€æ³•**ï¼šåªå¼€äº†ä¸€ä¸ªæ•°ç»„ æ•°æ®èŒƒå›´çš„ 2~3 å€ï¼Œå¦‚æœå½“å‰å‘ä½æœ‰äºº å°±ç»§ç»­å‘åæ‰¾ä½ç½®

```C++
// å¼€æ•°æ®èŒƒå›´çš„ä¸¤å€ inf è¡¨ç¤ºç©º
const int N = 1e5+7, inf = 0x3f3f3f3f;
int n, set[N];
// æ ¸å¿ƒå‡½æ•°
// æ‰¾åˆ° x åº”è¯¥åœ¨ hash ä¸­çš„ä½ç½®
int find(int x) {
    int t = (x % N + N) % N;
    int k = t;
    while (set[k] != inf && set[k] != x) {
        k++;
        if (k == N) k = 0;
    }
    return k;
}
int main() {
    // inf è¡¨ç¤ºæ²¡æœ‰å…ƒç´ ï¼ˆä¸ºç©ºï¼‰
    memset(set, 0x3f, sizeof set);
    cin >> n;
    while (n--) {
        char op;
        cin >> op;
        int x;
        cin >> x;
        if (op == 'I') set[find(x)] = x;
        else {
            if (set[find(x)] == x) cout << "Yes" << endl;
            else cout << "No" << endl;
        }
    }
    return 0;   
}
```

### å­—ç¬¦ä¸²å“ˆå¸Œ

è¿™é‡Œçš„å“ˆå¸Œæ–¹å¼æ˜¯æŒ‡ **å­—ç¬¦ä¸²å‰ç¼€å“ˆå¸Œæ³•**

**è®¡ç®—å“ˆå¸Œå€¼**ï¼šæŠŠå­—ç¬¦ä¸²çœ‹æˆæ˜¯ä¸€ä¸ª `p` è¿›åˆ¶çš„æ•°ï¼Œç„¶åæŠŠ `p` è¿›åˆ¶çš„æ•°è½¬æˆ `10` è¿›åˆ¶çš„æ•°ï¼ˆæ•°å¯èƒ½å¾ˆå¤§ï¼‰ï¼Œæ¨¡ `Q`

**æ³¨æ„**ï¼š
- ä¸€èˆ¬ä¸èƒ½æŠŠå­—æ¯æ˜ å°„æˆ `0` è€Œæ˜¯ä» `1` å¼€å§‹ã€‚å› ä¸ºå¦‚æœæŠŠæ•°å­—æ˜ å°„æˆ `0` å°±ä¼šå‡ºç° `A=0 AA=00=0 AAA=000=0 ...`  æ— æ³•åŒºåˆ†çš„æƒ…å†µ
- ä¸è€ƒè™‘å†²çªæƒ…å†µï¼Œåœ¨å– `p = 131 or 13331 & Q = 2^64` æ—¶ï¼Œ99.99% ä¸ä¼šå†²çª
- å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `unsigned long long` å­˜æ•°å­—ï¼Œè¿™æ ·å½“æ•°å­—æº¢å‡ºæ—¶ï¼Œå°±ä¼š**è‡ªåŠ¨å–æ¨¡**

åˆ©ç”¨ä¸Šè¿°è®¡ç®—æ–¹å¼ï¼Œè®¡ç®—æ‰€æœ‰çš„**å­—ç¬¦ä¸²å‰ç¼€å“ˆå¸Œå€¼**ã€‚

è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ `h[l-1] h[r]` æ±‚å‡ºå­—ä¸² `[l, r]` çš„å“ˆå¸Œå€¼ï¼Œè®¡ç®—å…¬å¼ï¼š`h[r] - h[l - 1] * p ^ (r - l + 1)`ã€‚æ³¨æ„ï¼šå·¦è¾¹æ˜¯é«˜ä½ï¼Œå³è¾¹æ˜¯ä½ä½

[841. å­—ç¬¦ä¸²å“ˆå¸Œ](https://www.acwing.com/problem/content/843/) ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¿«é€Ÿåˆ¤æ–­å…¶ä¸­çš„ä¸¤ä¸ªå­ä¸²æ˜¯å¦ç›¸åŒ

```C++
using ULL = unsigned long long;
const int N = 1e5 + 7, P = 131;
int n, m;
char str[N];
ULL h[N], p[N];
int get(int l, int r) {  // å…¬å¼å¾ˆç²¾å¦™
    return h[r] - h[l-1] * p[r-l+1];
}
int main() {
    cin >> n >> m;
    cin >> str + 1;
    p[0] = 1; // å¤„ç†æ–¹å¹‚ å’Œ å­—ç¬¦ä¸²å‰ç¼€ hash
    for (int i = 1; i <= n; i++) {
        p[i] = p[i-1] * P;
        h[i] = h[i-1] * P + str[i];
    }
    // è¯¢é—®
    int l1, r1, l2, r2;
    while (m--) {
        cin >> l1 >> r1 >> l2 >> r2;
        if (get(l1, r1) == get(l2, r2)) cout << "Yes" << endl;
        else cout << "No" << endl;
    }
    return 0;
}
```