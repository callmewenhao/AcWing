#! https://zhuanlan.zhihu.com/p/653809111
# åŸºç¡€ç®—æ³•

## å¿«é€Ÿæ’åº

åˆ†æ²»çš„æ€æƒ³ï¼šå…ˆæŠŠåˆ†ç•Œç‚¹çš„ä½ç½®æ‰¾å¥½ï¼Œå†å¤„ç†ä¸¤ä¸ªå­åŒºé—´

å¿«é€Ÿæ’åºæ˜¯ä¸ç¨³å®šçš„ï¼Œå¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ `O(nlogn)`ï¼Œæœ€åæ˜¯ `O(n^2)`

æ­¥éª¤ï¼š

1. ç¡®å®šåˆ†ç•Œç‚¹ pivot

2. è°ƒæ•´åŒºé—´ï¼Œå¾—åˆ°ä¸¤ä¸ªåŒºé—´ï¼šç¬¬ä¸€ä¸ªåŒºé—´çš„å€¼éƒ½å°äºç­‰äº pivotï¼Œç¬¬äºŒä¸ªåŒºé—´çš„å€¼éƒ½å¤§äºç­‰äº pivot ğŸ”¥

3. é€’å½’åœ°å¤„ç†å·¦å³ä¸¤ä¸ªåŒºé—´

```C++
// y æ€»çš„å¿«æ’æ¨¡æ¿
void quickSort(int *q, int l, int r) {
    // å…ˆåˆ¤æ–­åŒºé—´æ˜¯å¦åˆæ³•
    if (r <= l) return;
    // åŒæŒ‡é’ˆåœ¨åŒºé—´ä¸¤ä¾§ pivot å–ä¸­é—´å€¼
    int  i = l - 1, j = r + 1, x = q[(r + l) >> 1];
    while (i < j) {
        // æ‰¾åˆ°å·¦ä¾§ç¬¬ä¸€ä¸ªå¤§äºç­‰äº x çš„ä½ç½®
        do i++; while (q[i] < x);
        // æ‰¾åˆ°å³ä¾§ç¬¬ä¸€ä¸ªå°äºç­‰äº x çš„ä½ç½®
        do j--; while (q[j] > x);
        // æ‰¾åˆ°çš„ä½ç½®åˆæ³• å°±äº¤æ¢æ•°å­—
        if (i < j) swap(q[i], q[j]);
    }
    // æœ€ç»ˆä½ç½® [l, j, j+1, r] æ³¨æ„ i=j æˆ–è€… i=j+1
    // é€’å½’åœ°å¤„ç†ä¸¤ä¸ªå­åŒºé—´ [l, j] [j+1, r]
    quickSort(q, l, j);  // ä½†æ˜¯æ•°æ®åŠ å¼ºäº† è²Œä¼¼åªæœ‰è¿™ç§å†™æ³•å¯ä»¥AC
    quickSort(q, j + 1, r);
}
```

## ç¬¬ Kth æ•°

> å¿«é€Ÿé€‰æ‹©ç¬¬ k å°çš„æ•°å­—
> C++ STL `nth_element(a, a+k-1, a+n);` æ±‚æ•°ç»„ a ä¸­ç¬¬ k å°çš„æ•°

æ€è·¯ç±»ä¼¼äºå¿«æ’ï¼š

- æ¯æ¬¡é€‰ä¸€ä¸ªæ•°ï¼Œä»¥è¿™ä¸ªæ•°ä¸ºåŸºå‡†ï¼ŒæŠŠåŒºé—´åˆ†æˆä¸¤åŠ

- æ ¹æ® k çš„å¤§å°å’ŒåŒºé—´çš„å¤§å°ï¼Œå†³å®šç»§ç»­å¯»æ‰¾çš„åŒºé—´

- ç„¶åé€’å½’çš„æ‰¾åˆ°ç›®æ ‡æ•°å­—

æ—¶é—´å¤æ‚åº¦åˆ†æï¼šæ¯æ¬¡æŠŠåŒºé—´åˆ†æˆä¸¤åŠï¼Œç„¶åé€‰å…¶ä¸­ä¸€ä¸ªè¿›è¡Œé€’å½’ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ï¼š`n + n/2 + n/4 + ... = n(1 + 1/2 + 1/4 + ...) <= 2n`ï¼Œæ•…æ—¶é—´å¤æ‚åº¦å°±æ˜¯ `O(n)`

```C++
int n, k, a[N];
// è¿”å›ç¬¬ k å°çš„æ•°å­—
int kth(int l, int r, int k) {
    // åŒºé—´é•¿åº¦ä¸º 1 ç›´æ¥è¿”å›ç­”æ¡ˆ
    if (l >= r) return a[l];
    // å¿«æ’çš„æ¨¡æ¿
    int i = l-1, j = r+1, x = a[(l+r)/2];
    while (i < j) {
        while (a[++i] < x);
        while (a[--j] > x);
        if (i < j) swap(a[i], a[j]);
    }
    // é€‰æ‹©ä¸€è¾¹è¿›è¡Œé€’å½’
    // å·¦è¾¹ä¸ªæ•° j-l+1
    if (j-l+1 >= k) return kth(l, j, k);
    return kth(j+1, r, k-(j-l+1));
}
```

## å½’å¹¶æ’åº

åˆ†æ²»çš„æ€æƒ³ï¼šå…ˆæŠŠä¸¤ä¸ªå­åŒºé—´æ’å¥½åºï¼Œå†åˆå¹¶è¿™ä¸¤ä¸ªæœ‰åºçš„å­åŒºé—´

å½’å¹¶æ’åºæ˜¯ç¨³å®šçš„ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ `O(nlogn)`

æ­¥éª¤ï¼š

- æŠŠåŒºé—´åˆ’åˆ†æˆä¸¤ä¸ªå­åŒºé—´ï¼Œä¸€èˆ¬ä»ä¸­é—´åˆ†å‰²

- é€’å½’æ’åºå·¦å³ä¸¤ä¸ªå­åŒºé—´

- åˆå¹¶ä¸¤ä¸ªæœ‰åºçš„å­åŒºé—´ ğŸ”¥

```C++
void merge_sort(int a[], int l, int r) {
    // åˆ¤æ–­åŒºé—´æ˜¯å¦åˆæ³•
    if (r <= l) return;
    // åˆ’åˆ†ä¸¤ä¸ªå­åŒºé—´ 
    int mid = (l + r) >> 1;
    // é€’å½’å¤„ç†ä¸¤ä¸ªå­åŒºé—´
    merge_sort(a, l, mid);
    merge_sort(a, mid + 1, r);
    // åˆå¹¶ä¸¤ä¸ªæœ‰åºçš„å­åŒºé—´
    int k = 0, i = l, j = mid + 1;
    while (i <= mid && j <= r) {
        if (a[i] <= a[j]) temp[k++] = a[i++];
        else temp[k++] = a[j++];
    }
    while (i <= mid) temp[k++] = a[i++];
    while (j <= r) temp[k++] = a[j++];
    // ç§»åŠ¨å…ƒç´ 
    for (i = l, j = 0; i <= r; i++, j++) {
        a[i] = temp[j];
    }
}
```

## é€†åºå¯¹ä¸ªæ•°

> åˆ†æ²»æ’åºçš„ç»å…¸åº”ç”¨

æ€æƒ³ï¼š

- æŠŠåŒºé—´åˆ†æˆä¸¤åŠï¼šå·¦è¾¹ `[l, mid]` å³è¾¹ `[mid+1, r]`

- é€†åºå¯¹çš„ä¸ªæ•°ç­‰äºï¼šå·¦è¾¹åŒºé—´é€†åºå¯¹çš„ä¸ªæ•° + å³è¾¹åŒºé—´é€†åºå¯¹çš„ä¸ªæ•° + æ¨ªè·¨ä¸¤ä¸ªåŒºé—´çš„é€†åºå¯¹ä¸ªæ•°

- å·¦å³åŒºé—´å†…çš„é€†åºå¯¹ä¸ªæ•°é€’å½’æ±‚è§£

- æ¨ªè·¨ä¸¤ä¸ªåŒºé—´çš„é€†åºå¯¹ä¸ªæ•°ï¼Œåœ¨åˆ†æ”¯æ’åºçš„åˆå¹¶è¿‡ç¨‹ä¸­è®¡ç®—
  
    - å¯ä»¥è¿™æ ·è®¡ç®—ï¼Œå¯¹äºå³è¾¹åŒºé—´çš„æ¯ä¸€ä¸ªæ•° `R[j]`ï¼Œå·¦è¾¹åŒºé—´æœ‰å¤šå°‘ä¸ªæ•°æ¯”å®ƒå¤§ï¼Œè€Œä¸”å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ•° `L[i]` åˆ°åŒºé—´æœ«å°¾çš„æ•°éƒ½æ¯”å®ƒå¤§ï¼Œç´¯åŠ è¿™é•¿åº¦å³å¯

```C++
// å½’å¹¶æ’åºçš„è¿‡ç¨‹ä¸­ è®¡ç®—åŒºé—´å†…é€†åºå¯¹ä¸ªæ•°
LL merge_sort(int l, int r) {
    if (l >= r) return 0;
    
    int mid = (l+r)/2;
    // é€’å½’è®¡ç®—å·¦å³ä¸¤ä¸ªåŒºé—´å†…çš„é€†åºå¯¹ä¸ªæ•°
    LL res = merge_sort(l, mid) + merge_sort(mid+1, r);
    
    // åˆå¹¶ è®¡ç®—è·¨åŒºé—´çš„é€†åºå¯¹ä¸ªæ•°
    int k = 0, i = l, j = mid + 1;
    while (i <= mid && j <= r) {
        if (a[i] <= a[j]) t[k++] = a[i++];
        else {
            // ä»¥å³åŒºé—´å†…çš„ç‚¹ä¸ºåŸºå‡†ï¼Œç´¯åŠ å·¦è¾¹å¤§äºè¿™ä¸ªç‚¹çš„ä¸ªæ•°
            res += mid - i + 1;
            t[k++] = a[j++];
        }
    }
    while (i <= mid) t[k++] = a[i++];
    while (j <= r) t[k++] = a[j++];
    
    for (i = l, j = 0; i <= r; i++, j++) {
        a[i] = t[j];
    }
    return res;
}
```

## æ•´æ•°äºŒåˆ†

æŒæ¡ä¸€ä¸ª **å¤§äºç­‰äº x** æ¨¡æ¿ `left_search(x)` å°±è¡Œ

- ç¬¬ä¸€ä¸ªå¤§äºç­‰äº x çš„ä½ç½®ï¼š`left_search(x)`

- ç¬¬ä¸€ä¸ªå¤§äº x çš„ä½ç½®ï¼š`left_search(x+1)`

- æœ€å¤§çš„å°äºç­‰äº x çš„ä½ç½®ï¼š`left_search(x+1)-1`

- æœ€å¤§çš„å°äº x çš„ä½ç½®ï¼š`left_search(x) - 1`

æ³¨æ„ï¼šæ‰¾åˆ°ä½ç½®ä¹‹åè¿˜è¦åˆ¤æ–­æ˜¯ä¸æ˜¯è¿™ä¸ªå€¼ï¼Œå› ä¸ºå¯èƒ½å¤§äºæˆ–è€…å°äº

- `l == n` è¡¨ç¤ºæ²¡æ‰¾åˆ°
- `a[l] != x` è¡¨ç¤ºæ‰¾åˆ°çš„æ•°å¤§äº xï¼Œä¸æ˜¯ç­‰äº x

```C++
// é—­åŒºé—´æ¨¡æ¿
int left_serach(int x) {
    // é—­åŒºé—´ [l, r] éƒ½èƒ½å–åˆ°
    int l = 0, r = n - 1;
    while (l <= r) {
        int mid = l + (r - l) / 2;
        // äºŒåˆ†çš„ä½ç½®å°äºç›®æ ‡å€¼
        if (a[mid] < x) l = mid + 1;
        // å¤§äºç›®æ ‡å€¼
        else r = mid - 1;
    }
    // l å°±æ˜¯ç¬¬ä¸€ä¸ªå¤§äºç­‰äº x çš„ä½ç½®
    return l;
}
```

## æµ®ç‚¹æ•°äºŒåˆ†

æµ®ç‚¹æ•°äºŒåˆ†ä¸ç”¨è€ƒè™‘è¾¹ç•Œï¼Œä½†æ˜¯è€ƒè™‘ç²¾åº¦

ç²¾åº¦ç»éªŒå€¼ï¼š

- ç­”æ¡ˆè¦æ±‚ç²¾åº¦åœ¨ 1e-4 å†…ï¼Œåˆ™æˆ‘ä»¬å®é™…ä¸Šè¦æ§åˆ¶åœ¨ 1e-6 å†…

- ç­”æ¡ˆè¦æ±‚ç²¾åº¦åœ¨ 1e-6 å†…ï¼Œåˆ™æˆ‘ä»¬å®é™…ä¸Šè¦æ§åˆ¶åœ¨ 1e-8 å†…

**å¼€å¹³æ–¹ä¸¾ä¾‹**

è¿™ä¸ªé¢˜ç›®è¦æ³¨æ„ï¼Œå½“ x å¤§äºç­‰äº 1 æ—¶ï¼Œå¹³æ–¹æ ¹åœ¨ 1 ~ x ä¹‹é—´ï¼›å½“ x å°äº 1 æ—¶ï¼Œå¹³æ–¹æ ¹åœ¨ x ~ 1 ä¹‹é—´ã€‚ä½†æ˜¯ï¼Œæ•°è½´ä¸Šçš„æ•°è¿˜æ˜¯æ»¡è¶³äºŒåˆ†æ€§è´¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥å¼ºåˆ¶äºŒåˆ†çš„æ•°æ®èŒƒå›´ï¼Œæ¯”å¦‚ï¼š0. ~ 10000.


```C++
double a;  // å¾…å¼€å¹³æ–¹çš„å€¼
cin >> a;

// è¾¹ç•Œ
double l = 0., r = 10000.;
// äºŒåˆ†åŒºé—´åœ¨ 1e-8 ä»¥å†…ï¼ˆä¹Ÿå°±æ˜¯ç²¾åº¦å¯æ¥å—æ—¶ï¼‰ï¼Œè®¤ä¸ºæ‰¾åˆ°äº†å¯æ¥å—çš„ç­”æ¡ˆï¼Œä¹Ÿå¯ä»¥è¿™é‡Œç›´æ¥å¾ªç¯ 100 æ¬¡
while (r - l > 1e-8) {
    // äºŒåˆ†ä¸­é—´å€¼
    double mid = (l + r) / 2;
    // æ›´æ–°åŒºé—´ = å·åœ¨å“ªé‡Œå…³ç³»ä¸å¤§
    if (mid * mid > a) r = mid;
    else l = mid;
}
// è¾“å‡ºç­”æ¡ˆ å°æ•°ç‚¹åå…­ä½
printf("%.6lf\n", l);
```

æ•°çš„ä¸‰æ¬¡æ–¹æ ¹
```C++
#include <iostream>
using namespace std;
const double prec = 1e-8;
int main() {
    double n;
    cin >> n;
    // æ•°æ®èŒƒå›´æ˜¯ -10000~10000 å¯¹åº”è¾¹ç•Œ -100~100
    double l = -100., r = 100.;
    while (r - l > prec) {
        double mid = (r + l) / 2;
        if (mid * mid * mid >= n) r = mid;
        else l = mid;
    }
    printf("%.6lf", l);
    return 0;
}
```

## é«˜ç²¾åº¦åŠ ã€å‡ã€ä¹˜ã€é™¤

python ä¸­çš„ int é»˜è®¤æ— é™å¤§ å’Œ java è‡ªå¸¦å¤§æ•´æ•°ç±»ï¼ŒC++ è¦è‡ªå·±å®ç°ğŸ§

å¤§æ•´æ•°ä¸€èˆ¬æŠŠæ¯ä¸€ä½å­˜åˆ°æ•°ç»„é‡Œé¢å»ï¼Œä»å¤§æ•°çš„**ä¸ªä½**å¼€å§‹å­˜ï¼ˆå€’åºå­˜ï¼‰ï¼Œè¿™æ ·æœ€é«˜ä½è¿›ä½åªéœ€åœ¨æ•°ç»„åé¢åŠ ä¸€ä½ã€‚

### åŠ æ³• A + B

- ä»£ç æ¨¡æ‹ŸåŠ æ³•çš„è¿‡ç¨‹ï¼Œæ¯ä¸€è½®æœ‰ä¸‰ä¸ªæ•°ç›¸åŠ ï¼š$a_i$ $b_i$ è¿›ä½ $c_i$ï¼Œè¿™ä¸€ä½çš„ç»“æœæ˜¯ $(a_i + b_i+ c_i) \mod 10$ï¼Œæ–°çš„è¿›ä½æ˜¯ $(a_i + b_i+ c_i) / 10$ 

```C++
// æ³¨æ„ å¤§æ•°æ•°ç»„éƒ½æ˜¯åç€å­˜çš„ï¼šå…ˆå­˜ä¸ªä½å†å­˜é«˜ä½
vector<int> add(vector<int>& A, vector<int>& B) {
    vector<int> C; // ç­”æ¡ˆ
    int t = 0; // è¿›ä½
    for (int i = 0; i < A.size() || i < B.size(); i++) {
        if (i < A.size()) t += A[i];
        if (i < B.size()) t += B[i];
        C.push_back(t % 10);  // ç»“æœ
        t /= 10; // æ›´æ–°è¿›ä½
    }
    if (t) C.push_back(t);  // æœ€ååˆ¤æ–­æ˜¯å¦è¿›ä½
    return C;
}
```

### å‡æ³• A - B

- é¦–å…ˆï¼Œä¿è¯ A >= Bï¼Œå¦åˆ™äº¤æ¢ Aï¼ŒB è®¡ç®—ç»“æœï¼Œç„¶ååŠ ä¸€ä¸ªè´Ÿå·

- ä»£ç æ¨¡æ‹Ÿå‡æ³•çš„è¿‡ç¨‹ï¼Œæ¯ä¸€è½®æœ‰ä¸‰ä¸ªæ•°å‚ä¸è®¡ç®—ï¼š$a_i$ $b_i$ å€Ÿä½ $c_i$ï¼Œ$a_i - b_i - c_i$ã€‚å¦‚æœè®¡ç®—ç»“æœå°äºé›¶ï¼Œåˆ™éœ€å‘å‰ä¸€ä½å€Ÿä½ã€‚

```C++
// åˆ¤æ–­ A æ˜¯å¦å¤§äºç­‰äº B
bool cmp(vector<int>& A, vector<int>& B) {
    if (A.size() != B.size()) return A.size() > B.size();
    for (int i = 0 ; i < A.size(); i++) {
        if (A[i] != B[i]) return A[i] > B[i];
    }
    return true;
}

// è®¡ç®— A - B æ³¨æ„ A æ˜¯å¤§äºç­‰äº B çš„
vector<int> sub(vector<int>& A, vector<int>& B) {
    vector<int> C;
    int t = 0;
    for (int i = 0; i < A.size(); i++) {
        t = A[i] - t;
        if (i < B.size()) t -= B[i];
        C.push_back((t + 10) % 10);
        // æ›´æ–°å€Ÿä½
        if (t < 0) t = 1;
        else t = 0;
    }
    // å»æ‰ç»“æœä¸­å¤šä½™çš„å‰ç¼€é›¶
    while (C.size() > 1 && !C.back()) {
        C.pop_back();
    }
    return C;
}
// int main()
if (cmp(A, B)) {
    auto C = sub(A, B);
    for (int i = C.size() - 1; i >= 0; i--) {
        cout << C[i];
    }
} else {
    cout << "-";
    auto C = sub(B, A);
    for (int i = C.size() - 1; i >= 0; i--) {
        cout << C[i];
    }
}
```

### ä¹˜æ³• A * b

- é«˜ç²¾åº¦ä¹˜æ³•æ˜¯å¤§æ•° A ä¹˜ä»¥å°æ•° bï¼Œè¿ç®—çš„è¿‡ç¨‹ä¸­ä¸æ‹†å°æ•°ï¼Œå°æ•°æ•´ä¸ªå‚ä¸è¿ç®—ã€‚

- ä»£ç æ¨¡æ‹Ÿä¹˜æ³•çš„è¿‡ç¨‹ï¼Œæ¯ä¸€è½®æœ‰ä¸‰ä¸ªæ•°å‚ä¸è®¡ç®—ï¼š$a_i$ $b$ è¿›ä½ $c_i$


```C++
vector<int> mul(vector<int>& A, int b) {
    vector<int> C;
    int t = 0;
    for (int i = 0; i < A.size() || t; i++) {
        if (i < A.size()) t += A[i] * b;
        C.push_back(t % 10);  // ç»“æœ
        t /= 10;  // è¿›ä½
    }
    // å»æ‰å‰å¯¼é›¶
    while (C.size() > 1 && C.back() == 0) {
        C.pop_back();
    }
    return C;
}
```

### é™¤æ³• A / b

- é«˜ç²¾åº¦é™¤æ³•æ˜¯å¤§æ•° A é™¤ä»¥å°æ•° bï¼Œè¿ç®—çš„è¿‡ç¨‹ä¸­ä¸æ‹†å°æ•°ï¼Œå°æ•°æ•´ä¸ªå‚ä¸è¿ç®—ã€‚

- ä»£ç æ¨¡æ‹Ÿä¹˜æ³•çš„è¿‡ç¨‹ï¼Œæ¯ä¸€è½®æœ‰ä¸‰ä¸ªæ•°å‚ä¸è®¡ç®—ï¼š$a_i$ $b$ ä½™æ•° $c_i$

```C++
// int& r æ˜¯ä½™æ•°
vector<int> div(vector<int>& A, int b, int& r) {
    vector<int> C;

    r = 0;
    for (int i = A.size() - 1; i >= 0; i--) {
        r = r * 10 + A[i];
        C.push_back(r / b);
        r %= b;
    }
    // ç­”æ¡ˆåè¿‡æ¥
    reverse(C.begin(), C.end());

    // å»æ‰å‰å¯¼é›¶
    while (C.size() > 1 && C.back() == 0) {
        C.pop_back();
    }
    return C;
}
```

## å‰ç¼€å’Œ

### ä¸€ç»´å‰ç¼€å’Œ

æ•°ç»„ Aï¼š$a_1, a_2, a_3, ..., a_n$ï¼Œå¯¹åº”å‰ç¼€å’Œ Sï¼š$s_1, s_2, s_3, ..., s_n$

- æ±‚å‰ç¼€å’Œ $S_i$ï¼š$S_i = S_{i-1} + a_i$

- ä½œç”¨ï¼šO1 åœ°è®¡ç®—å‡ºåŒºé—´ `[i, j]` å’Œï¼š$S_{i~j} = S_j - S_{i-1}$

- è®¡ç®—å‰ç¼€å’Œæ—¶ï¼Œæ•°ç»„ä¸‹æ ‡ä¸€èˆ¬ä» 1 å¼€å§‹ï¼Œå¹¶è§„å®š $S_0  = 0$

### äºŒç»´å‰ç¼€å’Œ

- æ±‚äºŒç»´æ•°ç»„ä¸­æŸä¸ªåŒºåŸŸ `[(x1, y1)->(x2, y2)]` çš„å’Œï¼š`s[x2][y2] - s[x1-1][y2] - s[x2][y1-1] + s[x1-1][y1-1]`

- è®¡ç®—å‰ç¼€å’Œ `s[x][y] = a[x][y] + s[x-1][y] + s[x][y-1] - s[x-1][y-1]`

<!-- ![test image size](/å›¾ç‰‡/å‰ç¼€å’Œ.png) -->
![Image](https://pic4.zhimg.com/80/v2-d89ba0b51a9927d7a64d7496fbcee924.png)
```C++
// è®¡ç®—äºŒç»´å‰ç¼€å’Œ
for (int i = 1; i <= n; i++) {
    for (int j = 1; j <= m; j++) {
        s[i][j] = a[i][j] + s[i-1][j] + s[i][j-1] - s[i-1][j-1];
    }
}
// æŸ¥è¯¢åŒºåŸŸå’Œ
int x1, x2, y1, y2;
while (q--) {
    cin >> x1 >> y1 >> x2 >> y2;
    int res = s[x2][y2] - s[x2][y1-1] - s[x1-1][y2] + s[x1-1][y1-1];
    cout << res << endl;
}
```

## å·®åˆ†

å·®åˆ†æ˜¯å‰ç¼€å’Œçš„é€†è¿ç®—

### ä¸€ç»´å·®åˆ†

æœ‰æ•°ç»„ï¼šAï¼š$a_1, a_2, a_3, ..., a_n$ï¼Œæ„é€ æ•°ç»„ Dï¼š$d_1, d_2, d_3, ..., d_n$ï¼Œä½¿å¾— $a_i = d_1 + d_2 + ... + d_i$ï¼Œæ•°ç»„ D å°±æ˜¯ A çš„å·®åˆ†æ•°ç»„ï¼Œè€Œ A æ˜¯ D çš„å‰ç¼€å’Œ

- å¯ä»¥å¿«é€Ÿè¿›è¡Œ**åŒºé—´ä¿®æ”¹**çš„æ“ä½œï¼šè¿›è¡Œ n æ¬¡åŒºé—´ [l, r] çš„ä¿®æ”¹ï¼Œå¯ä»¥åœ¨å·®åˆ†æ•°ç»„ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œç„¶åè®¡ç®—å‰ç¼€å’Œå¾—åˆ°ç›®æ ‡æ•°ç»„

- ç»™åŸæ•°ç»„ A åŒºé—´ `[l, r]` ä¸­çš„æ¯ä¸€ä¸ªæ•°åŠ  cï¼Œç­‰ä»·äºåœ¨å·®åˆ†æ•°ç»„ `D[l]` å¤„åŠ  cï¼Œ`D[r+1]` å¤„å‡ C

- å·®åˆ†æ•°ç»„çš„æ„é€ å¯ä»¥ä½¿ç”¨ä¿®æ”¹åŒºé—´çš„æ€æƒ³ï¼šå…ˆå‡è®¾å…ƒç´ ç»„å…¨æ˜¯ 0ï¼Œå‘å…¶ä¸­æ’å…¥æŸæ•°å¯ä»¥çœ‹ä½œåœ¨æŸä¸ªä½ç½®åŠ è¿™ä¸ªæ•°ï¼Œå¯¹åº”åˆ°å·®åˆ†æ•°ç»„å°±æ˜¯åŒºé—´è¾¹ç•ŒåŠ å‡è¿™ä¸ªæ•°ã€‚å¦‚ï¼š`a[i] = 2 -> d[i] += 2, d[i+1] -= 2`

```C++
// è®¡ç®—å·®åˆ†æ•°ç»„
for (int i = 1; i <= n; i++) {
    d[i] += a[i];
    d[i+1] -= a[i];
}
// m æ¬¡ä¿®æ”¹
int l, r, c;
while (m--) {
    cin >> l >> r >> c;
    d[l] += c;
    d[r+1] -= c;
}
// è®¡ç®—å‰ç¼€å’Œ
for (int i = 1; i <= n; i++) {
    d[i] += d[i-1];
    cout << d[i] << " ";
}
```

### äºŒç»´å·®åˆ†

å¯¹äºäºŒç»´æ•°ç»„ `A[n][m]`ï¼Œæ„é€ å¯¹åº”çš„äºŒç»´å·®åˆ†æ•°ç»„ `D[n][m]`ï¼ŒåŒæ ·å¯ä»¥å¿«é€Ÿå®ç°æŸä¸ªåŒºåŸŸå†…æ•°å€¼çš„ä¿®æ”¹

- å°†å­åŒºåŸŸ `A[x1][y1]->A[x2][y2]` å†…çš„æ•°åŠ ä¸Š cï¼š`D[x1][y1] += c; D[x2+1][y1] -= c; D[x1][y2+1] -= c; D[x2+1][y2+1] += c`

- æ±‚è¿™ä¸ªå·®åˆ†æ•°ç»„ Dï¼šä¸ä¸€ç»´ç›¸åŒçš„æ€è·¯ï¼Œæ¯ä¸€ä¸ªå…ƒç´ ç›¸å½“äºåœ¨ 0 çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¿®æ”¹ï¼Œ`a[i][j] = x -> d[i][j] += x, d[i+1][j] -= x, d[i][j+1] -= x, d[i+1][j+1] += x` 

<!-- ![test image size](/å›¾ç‰‡/å·®åˆ†.png) -->
![Image](https://pic4.zhimg.com/80/v2-fca15a2f7b47236b979325e9743f598e.png)
```C++
// æ’å…¥å‡½æ•°
void insert(int x1, int y1, int x2, int y2, int c) {
    d[x1][y1] += c;
    d[x2 + 1][y1] -= c;
    d[x1][y2 + 1] -= c;
    d[x2 + 1][y2 + 1] += c;
}
// main()
// ä½¿ç”¨ä¿®æ”¹å‡½æ•°æ„é€ 
for (int i = 1; i <= n; i++)
    for (int j = 1; j <= m; j++)
        insert(i, j, i, j, a[i][j]);
// ä¿®æ”¹
int x1, y1, x2, y2, c;
while (q--) {
    cin >> x1 >> y1 >> x2 >> y2 >> c;
    insert(x1, y1, x2, y2, c);
}
// è®¡ç®—
for (int i = 1; i <= n; i++)
    for (int j = 1; j <= m; j++)
        d[i][j] += d[i-1][j] + d[i][j-1] - d[i-1][j-1];
```

## åŒæŒ‡é’ˆ

ä¸¤ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘ä¸¤ä¸ªä¸åŒçš„æ•°ç»„ã€‚å¯ä»¥æŠŠ O(n^2) çš„ç®—æ³•ä¼˜åŒ–åˆ° O(n)ã€‚

ä½¿ç”¨çš„åœºæ™¯éå¸¸å¹¿æ³›ï¼š

- å­—ç¬¦ä¸²é—®é¢˜ï¼šæ‰¾åˆ°å­—ç¬¦ä¸²ä¸­è¢«ç©ºæ ¼åˆ†å‰²çš„æ¯ä¸€ä¸ªå•è¯

- æ»‘åŠ¨çª—å£ï¼šåŒºé—´ [l, r] å†…çš„å…ƒç´ æ»¡è¶³ä¸€å®šçš„æ€§è´¨

- x æ•°ä¹‹å’Œï¼šç»å…¸ â€œæ’åº + ç›¸å‘åŒæŒ‡é’ˆâ€ 

æ—¶é—´å¤æ‚åº¦ï¼šO(n)

### åŒå‘åŒæŒ‡é’ˆï¼ˆæ»‘åŠ¨çª—å£ï¼‰

æ»‘åŠ¨çª—å£æœ€é‡è¦æ˜¯ç¡®å®šåŒºé—´ [l, r] å†…çš„å…ƒç´ æ»¡è¶³çš„æ€§è´¨ï¼Œè¿™å†³å®šäº† l å’Œ r çš„ç§»åŠ¨ï¼Œä»¥åŠç­”æ¡ˆçš„è®¡ç®—ã€‚åœ¨æ±‚æ–¹æ¡ˆæ•°çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™ l å¾€å³åˆ° r æ˜¯ç­”æ¡ˆï¼Œæœ‰æ—¶ l å¾€å·¦åˆ° 0 æ˜¯ç­”æ¡ˆã€‚

æœ€é•¿**è¿ç»­**ä¸é‡å¤å­åºåˆ—è¿™é¢˜ä¸­ï¼ŒåŒºé—´ [l, r] çš„å«ä¹‰å°±æ˜¯ä¸å«é‡å¤å…ƒç´ çš„åŒºé—´ã€‚æšä¸¾å³è¾¹ç•Œ rï¼Œæ‰¾åˆ°æœ€é å·¦çš„å·¦è¾¹ç•Œ lï¼Œé‚£ä¹ˆåŒºé—´å³ç«¯ç‚¹æ˜¯ r çš„æœ€é•¿çš„è¿ç»­å­åºåˆ—é•¿åº¦å°±æ˜¯ r - l + 1ã€‚

[799. æœ€é•¿**è¿ç»­**ä¸é‡å¤å­åºåˆ—](https://www.acwing.com/problem/content/801/)

```C++
int res = 1;
// æšä¸¾å³è¾¹ç•Œ
for (int r = 0, l = 0; r < n; r++) {
    cnt[a[r]]++;
    // æ”¶å·¦è¾¹ç•Œ æ‰¾åˆ°æœ€å·¦ä¾§çš„ l
    while (cnt[a[r]] > 1) {
        cnt[a[l]]--;
        l++;
    }
    // æ›´æ–°æœ€é•¿çš„å­åºåˆ—
    res = max(res, r - l + 1);
}
```

### ç›¸å‘åŒæŒ‡é’ˆ

[800. æ•°ç»„å…ƒç´ çš„ç›®æ ‡å’Œ](https://www.acwing.com/problem/content/802/)

å¯¹åº”åŠ›æ‰£ä¸Šçš„ä¸¤æ•°ä¹‹å’Œã€ä¸‰æ•°ä¹‹å’Œç­‰ï¼Œæ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šæ’åº + ç›¸å‘åŒæŒ‡é’ˆ

```C++
// ç›¸å‘åŒæŒ‡é’ˆ åˆ©ç”¨å•è°ƒæ€§
for (int i = 0, j = m - 1; i < n; i++) {
    while (A[i] + B[j] > x) {
        j--;
    }
    if (A[i] + B[j] == x) {
        cout << i << " " << j << endl;
        break;
    }
}
```

## lowbit

> æ ‘çŠ¶æ•°ç»„çš„åŸºæœ¬æ“ä½œ

[é¢˜ç›®ï¼šäºŒè¿›åˆ¶ä¸­1çš„ä¸ªæ•°](https://www.acwing.com/problem/content/803/)

lowbit æ˜¯æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­**æœ€ä½ä½çš„1**å¯¹åº”çš„æ•°å­—ã€‚æ¯”å¦‚ï¼š0x01001010 çš„ lowbit æ˜¯ 0x00000010

è®¡ç®—å…¬å¼ï¼š`lowbit(x) = x & (-x) = x & (~x + 1)`

```C++
// å€ŸåŠ© lowbit è®¡ç®—æ•° x äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•°
for (int i = 0; i < n; i++) {
    int x;
    cin >> x;
    int res = 0;
    while (x) {
        res++;
        x -= x & (-x);
    }
    cout << res << " ";
}
```

## ç¦»æ•£åŒ–

æœ‰äº›é¢˜ç›®çš„æ•°æ®å€¼å¯èƒ½å¾ˆå¤§ï¼Œæ¯”å¦‚ 1e9ï¼Œä½†æ˜¯æ•°æ®ä¸ªæ•°åœ¨ 1e5 èŒƒå›´å†…ã€‚

å¦‚æœä»¥å€¼ä¸ºä¸‹æ ‡åšé¢˜çš„è¯ï¼Œå°±éœ€è¦ä¸€ä¸ª 1e9 å¤§çš„æ•°ç»„ï¼Œè¿™ä¸å¯å–ã€‚è¿™æ—¶å°±éœ€è¦æŠŠè¿™äº›å€¼æ˜ å°„åˆ° 1e5 èŒƒå›´å†…ï¼Œè¿™æ ·å°±åªéœ€è¦ä¸€ä¸ª 1e5 å¤§çš„æ•°ç»„äº†

[é¢˜ç›®ï¼šåŒºé—´å’Œ](https://www.acwing.com/problem/content/804/)

ç¦»æ•£åŒ–çš„æ ¸å¿ƒæ­¥éª¤æ˜¯ï¼šæ’åºã€å»é‡ã€äºŒåˆ†

åœ¨C++ä¸­ä½¿ç”¨çš„å‡½æ•°å¦‚ä¸‹ï¼š

```C++
// y æ€»çš„å»é‡æ¨¡æ¿ è¿”å›ä¸€ä¸ªè¿­ä»£å™¨
vector<int>::iterator unique(vector<int>& a) {
    int j = 0; // j æŒ‡å‘å½“å‰å¯ä»¥å­˜æ”¾å…ƒç´ çš„ä½ç½®
    for (int i = 0; i < a.size(); i++) {
        // å¦‚æœ i==0 æˆ–è€… a[i] != a[i-1] å°±å­˜ä¸€ä¸‹
        if (!i || a[i] != a[i-1]){
            a[j++] = a[i];
        }
    }
    // è¿”å›æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®
    return a.begin() + j;
}

// ç¦»æ•£åŒ– 
// æ³¨æ„æŠŠç¦»æ•£åŒ–çš„æ‰€æœ‰å€¼éƒ½æ”¾åœ¨ä¸€èµ· æ¯”å¦‚ alls
sort(alls.begin(), alls.end());  // æ’åº
// unique å°†é‡å¤çš„å…ƒç´ æ”¾åˆ°å®¹å™¨çš„æœ«å°¾ï¼Œè¿”å›å€¼æ˜¯å»é‡ä¹‹åçš„å°¾åœ°å€
alls.erase(unique(alls.begin(), alls.end()), alls.end());  // å»é‡
// è‡ªå·±å†™ä¸€ä¸ªäºŒåˆ†ä¹Ÿè¡Œ æ³¨æ„ä¸‹æ ‡
int idx = lower_bound(alls.begin(), alls.end(), pairs[i].first) - alls.begin();  // ç¦»æ•£åŒ–åçš„ä¸‹æ ‡
```

## åˆå¹¶åŒºé—´

åŒºé—´é—®é¢˜æ˜¯ç»å…¸çš„è´ªå¿ƒé—®é¢˜ï¼Œæ­¤é¢˜ä¹Ÿä¸ä¾‹å¤–ï¼šæ’åº+ä¸€æ¬¡æšä¸¾

```C++
cin >> n;
for (int i = 0; i < n; i++) {
    int l, r;
    cin >> l >> r;
    a.push_back({l, r});
}

sort(a.begin(), a.end());

int res = 0, end = -2e9;  // ç»´æŠ¤æœ€å³ä¾§åŒºé—´ç«¯ç‚¹
for (auto [l, r]: a) {
    if (end < l) {
        res++;
        end = r;
    } else {
        end = max(end, r);
    }
}
cout << res << endl;
```
